<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ë‹¨ì–´ ê²Œì„ - ë§ˆì´ë©œë¡œë””</title>
    <link rel="icon" href="/static/images/mymelody_favicon.png">
    <link rel="stylesheet" href="/static/wordle-style.css">
    <link rel="stylesheet" href="/static/sidebar-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .progress-fill {
            width: {{ achievement_rate }}%;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="/main" class="logo-link">
            <img src="/static/images/mymelody_logo.png" alt="ë§ˆì´ë©œë¡œë”” ë¡œê³ ">
        </a>
        <a href="/quest" class="button-link" data-text="í€˜ìŠ¤íŠ¸">ğŸ—ï¸</a>
        <a href="/voice" class="button-link" data-text="AI ëª©ì†Œë¦¬">ğŸ™ï¸</a>
        <a href="/wordle-index" class="button-link" data-text="ì˜ë‹¨ì–´ ê²Œì„">ğŸ®</a>

        <div class="sidebar-bottom">
            <a href="/mypage"> <i class="fas fa-cog"></i> <!-- ì„¤ì • ì•„ì´ì½˜ --> </a>
            <i class="fas fa-sign-out-alt" id="logoutIcon"></i> <!-- ë¡œê·¸ì•„ì›ƒ ì•„ì´ì½˜ -->
        </div>
    </div>

    <!-- ë¡œê·¸ì•„ì›ƒ í™•ì¸ ëª¨ë‹¬ -->
    <div id="logoutModal" class="logout-modal">
        <div class="logout-modal-content">
            <p>ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <button id="confirmLogout" class="btn-confirm">ì˜ˆ</button>
            <button id="cancelLogout" class="btn-cancel">ì•„ë‹ˆìš”</button>
        </div>
    </div>

    <!-- Main Content Area (Wordle Game) -->
    <div id="game-container">
        <h1>Wordle Game</h1>
        <div id="word-grid" tabindex="0"></div> <!-- Add tabindex to make it focusable -->
        <div id="message"></div>
        <div id="definition"></div>
        <button id="new-game-btn">New Game</button>
    </div>

    <div class="right-panel">
        <div class="profile">
            <img id="profile-pic" src="/static/images/profile/{{ profile_img }}" alt="í”„ë¡œí•„ ì‚¬ì§„">
            <div>
                <p id="user-info"> {{ nickname }} ë‹˜! ì˜¤ëŠ˜ë„ ì—´ê³µğŸ”¥</p>
            </div>
        </div>
        <div class="quote">
            <p style="font-weight: bold;">ğŸ“£ ëª…ì–¸ ì˜ì–´ë¡œ ë³´ê¸°</p>
            <div class="quote-text">
                <p id="quote-ko">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>
                <p id="quote-en">-</p>
            </div>
        </div>
        <div class="progress">
            <p style="font-weight: bold;">ğŸ¯ ëª©í‘œ ë‹¬ì„±ë¥ </p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
        <div class="calendar">
            <p style="font-weight: bold;">ğŸ—“ï¸ ì¶œì„ ë‹¬ë ¥</p>
            <input type="text" id="current-date" readonly>
            <div class="calendar-box">
                <div id="current-month"></div>
                <!-- ë‹¬ë ¥ì´ í‘œì‹œë  ì˜ì—­ -->
                <div id="calendar"></div>
            </div>
        </div>
    </div>
    
    <script>
        const WORD_LENGTH = 5;
        const MAX_GUESSES = 6;
        let secretWord = '';
        let secretWordDefinition = '';
        let currentGuess = '';
        let guesses = [];

        const wordGrid = document.getElementById('word-grid');
        const messageElement = document.getElementById('message');
        const definitionElement = document.getElementById('definition');
        const newGameBtn = document.getElementById('new-game-btn');

        async function getRandomWord() {
            try {
                const response = await fetch('https://random-word-api.herokuapp.com/word?length=5');
                if (!response.ok) {
                    throw new Error('Network response was not ok.');
                }
                const data = await response.json();
                return data[0].toUpperCase();
            } catch (error) {
                console.error('Error fetching random word: ', error);
                return 'ERROR';
            }
        }

        async function getDefinition(word) {
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data && data[0] && data[0].meanings && data[0].meanings[0].definitions) {
                        return data[0].meanings[0].definitions[0].definition;
                    } else {
                        return 'Definition not found.';
                    }
                } else {
                    // Parse as JSON even if the response is not 200
                    const errorData = await response.json();
                    if (errorData.title === "No Definitions Found") {
                        if (word.endsWith('s')) {
                            // If the word ends with 's', remove it and search again
                            const singularWord = word.slice(0, -1);
                            return await getDefinition(singularWord);
                        }
                        return 'Definition not found.';
                    } else {
                        throw new Error('Unexpected error during fetch.');
                    }
                }
            } catch (error) {
                console.error('Error fetching word definition: ', error);
                return 'Definition not available.';
            }
        }

        async function cacheDefinition(word) {
            secretWordDefinition = await getDefinition(word);
        }

        async function initializeGame() {
            messageElement.textContent = 'Now Loading...';
            definitionElement.textContent = '';
            secretWord = await getRandomWord();
            cacheDefinition(secretWord.toLowerCase());
            currentGuess = '';
            guesses = [];
            messageElement.textContent = '';
            initializeGrid();
            updateGrid();
            // Move focus to word-grid to avoid button focus issues
            wordGrid.focus();
        }

        function initializeGrid() {
            wordGrid.innerHTML = '';
            for (let i = 0; i < MAX_GUESSES; i++) {
                for (let j = 0; j < WORD_LENGTH; j++) {
                    const letterBox = document.createElement('div');
                    letterBox.className = 'letter-box';
                    wordGrid.appendChild(letterBox);
                }
            }
        }

        function updateGrid() {
            const letterBoxes = wordGrid.children;
            for (let i = 0; i < MAX_GUESSES; i++) {
                for (let j = 0; j < WORD_LENGTH; j++) {
                    const letterBox = letterBoxes[i * WORD_LENGTH + j];
                    if (i < guesses.length) {
                        letterBox.textContent = guesses[i][j];
                        const colors = getColors(guesses[i]);
                        letterBox.style.backgroundColor = colors[j];
                    } else if (i === guesses.length && j < currentGuess.length) {
                        letterBox.textContent = currentGuess[j];
                        letterBox.style.backgroundColor = '';
                    } else {
                        letterBox.textContent = '';
                        letterBox.style.backgroundColor = '';
                    }
                }
            }
        }

        function getColors(guess) {
            const colors = Array(WORD_LENGTH).fill('#787c7e');
            const secretLetterCount = {};
            const guessLetterCount = {};

            for (let i = 0; i < WORD_LENGTH; i++) {
                secretLetterCount[secretWord[i]] = (secretLetterCount[secretWord[i]] || 0) + 1;
                guessLetterCount[guess[i]] = (guessLetterCount[guess[i]] || 0) + 1;
            }
            for (let i = 0; i < WORD_LENGTH; i++) {
                if (guess[i] === secretWord[i]) {
                    colors[i] = '#6aaa64';
                    secretLetterCount[guess[i]]--;
                    guessLetterCount[guess[i]]--;
                }
            }
            for (let i = 0; i < WORD_LENGTH; i++) {
                if (colors[i] !== '#6aaa64' && secretLetterCount[guess[i]] > 0 && guessLetterCount[guess[i]] > 0) {
                    colors[i] = '#c9b458';
                    secretLetterCount[guess[i]]--;
                    guessLetterCount[guess[i]]--;
                }
            }

            return colors;
        }

        async function handleGameEnd(isWin) {
            if (isWin) {
                messageElement.textContent = 'ì¶•í•˜í•©ë‹ˆë‹¤! ì •ë‹µì…ë‹ˆë‹¤!';
            } else {
                messageElement.textContent = `GAME OVER! ì •ë‹µì€ ${secretWord} ì…ë‹ˆë‹¤.`;
            }
            definitionElement.textContent = `ì •ë‹µì˜ ì˜ë¯¸: ${secretWordDefinition}`;
        }

        function handleKeyDown(event) {
            if (guesses.length >= MAX_GUESSES) return;

            if (event.key === 'Enter') {
                if (currentGuess.length === WORD_LENGTH) {
                    guesses.push(currentGuess);
                    if (currentGuess === secretWord) {
                        handleGameEnd(true);
                    } else if (guesses.length === MAX_GUESSES) {
                        handleGameEnd(false);
                    }
                    currentGuess = '';
                } else {
                    messageElement.textContent = 'ë‹¨ì–´ëŠ” 5ê¸€ìì—¬ì•¼ í•©ë‹ˆë‹¤.';
                }
            } else if (event.key === 'Backspace') {
                currentGuess = currentGuess.slice(0, -1);
            } else if (/^[A-Za-z]$/.test(event.key) && currentGuess.length < WORD_LENGTH) {
                currentGuess += event.key.toUpperCase();
            }
            updateGrid();
        }

        newGameBtn.addEventListener('click', () => {
            initializeGame();
            // Move focus to word-grid to avoid button focus issues
            wordGrid.focus();
        });

        document.addEventListener('keydown', handleKeyDown);

        initializeGame();

        document.addEventListener('DOMContentLoaded', function() {
            const logoutModal = document.getElementById('logoutModal');

            // ë¡œê·¸ì•„ì›ƒ ì•„ì´ì½˜ í´ë¦­ ì‹œ ëª¨ë‹¬
            document.getElementById('logoutIcon').addEventListener('click', function() {
                logoutModal.style.display = 'flex';
                logoutModal.style.opacity = 1;
            });
            document.getElementById('confirmLogout').addEventListener('click', function() {
                window.location.href = 'user-logout';
            });
            document.getElementById('cancelLogout').addEventListener('click', function() {
                logoutModal.style.opacity = 0;
                setTimeout(() => {
                    logoutModal.style.display = 'none';
                }, 100);
            });
        });
    </script>

    <script>
        // ëª…ì–¸ ë°ì´í„°
        const quotes = [
            { ko: "ê³ í†µ ì—†ì´ëŠ” ì–»ëŠ” ê²ƒë„ ì—†ë‹¤.", en: "No pain, no gain." },
            { ko: "ë°°ì›€ì€ ê²°ì½” ëë‚˜ì§€ ì•ŠëŠ”ë‹¤.", en: "Learning never ends." },
            { ko: "ì˜¤ëŠ˜ í•  ìˆ˜ ìˆëŠ” ì¼ì„ ë‚´ì¼ë¡œ ë¯¸ë£¨ì§€ ë§ˆë¼.", en: "Do not put off until tomorrow what you can do today." },
            { ko: "ì§€ì‹ì€ í˜ì´ë‹¤.", en: "Knowledge is power." },
            { ko: "ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆë‹¤.", en: "Failure is the mother of success." },
            { ko: "ë…¸ë ¥ì€ ê²°ì½” ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤.", en: "Effort never betrays." },
            { ko: "ìì‹ ì„ ë¯¿ì–´ë¼.", en: "Believe in yourself." },
            { ko: "í•œ ê±¸ìŒì”© ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ë¼.", en: "Take one step forward." },
            { ko: "ê¿ˆì„ í¬ê²Œ ê°€ì ¸ë¼.", en: "Dream big." },
            { ko: "ë§¤ì¼ ì¡°ê¸ˆì”© ë‚˜ì•„ì ¸ë¼.", en: "Get a little better every day." },
            { ko: "í•  ìˆ˜ ìˆë‹¤ê³  ë¯¿ì–´ë¼.", en: "Believe you can." },
            { ko: "ìì‹ ì˜ ê¸¸ì„ ì°¾ì•„ë¼.", en: "Find your own path." },
            { ko: "ì§€ê¸ˆ í–‰ë™í•˜ë¼.", en: "Act now." },
            { ko: "ê¸°íšŒëŠ” ì¤€ë¹„ëœ ìì—ê²Œ ì˜¨ë‹¤.", en: "Opportunity comes to those who are prepared." },
            { ko: "ì ˆëŒ€ í¬ê¸°í•˜ì§€ ë§ˆë¼.", en: "Never give up." },
            { ko: "ìì‹ ì˜ ì ì¬ë ¥ì„ ë¯¿ì–´ë¼.", en: "Believe in your potential." },
            { ko: "ìì‹ ì„ ë°œì „ì‹œì¼œë¼.", en: "Develop yourself." },
            { ko: "ì„±ê³µì€ ë…¸ë ¥ì˜ ê²°ê³¼ë‹¤.", en: "Success is the result of effort." },
            { ko: "ë¯¸ë˜ëŠ” ì§€ê¸ˆ ë§Œë“ ë‹¤.", en: "The future is made now." },
            { ko: "ê¾¸ì¤€í•¨ì´ ì—´ì‡ ë‹¤.", en: "Consistency is the key." }
        ];

        // ëœë¤ ëª…ì–¸ ì„ íƒ
        function displayRandomQuote() {
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const randomQuote = quotes[randomIndex];
            document.getElementById("quote-ko").innerText = randomQuote.ko;
            document.getElementById("quote-en").innerText = randomQuote.en;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª…ì–¸ í‘œì‹œ
        window.onload = displayRandomQuote;
        function displayCurrentMonth() {
            var currentDate = new Date(); // í˜„ì¬ ë‚ ì§œ ê°ì²´ ìƒì„±
            var monthNames = [
                "1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”",
                "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"
            ];
            var currentMonth = currentDate.getMonth(); // í˜„ì¬ ì›” ê°€ì ¸ì˜¤ê¸° (0ë¶€í„° ì‹œì‘)

            document.getElementById("current-month").innerHTML = monthNames[currentMonth];        
        }

        // ë‹¬ë ¥ì„ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function printCalendar(y, m) {
            var calendar_box = document.getElementById("calendar");

            // í˜„ì¬ ë‚ ì§œì™€ í˜„ì¬ ë‹¬ì— 1ì¼ì˜ ë‚ ì§œ ê°ì²´ ìƒì„±
            var date = new Date();
            var nowY = date.getFullYear(); // í˜„ì¬ ì—°ë„
            var nowM = date.getMonth(); // í˜„ì¬ ì›”
            var nowD = date.getDate(); // í˜„ì¬ ì¼

            // ì—°ë„, ì›”ì„ ì…ë ¥ë°›ì§€ ì•Šì€ ê²½ìš° í˜„ì¬ ë‚ ì§œì˜ ì—°ë„, ì›” ì •ë³´ë¥¼ ì‚¬ìš©í•¨
            y = (y != undefined) ? y : nowY;
            m = (m != undefined) ? m - 1 : nowM;

            // í˜„ì¬ ì›”ì˜ 1ì¼ ì •ë³´
            var theDate = new Date(y, m, 1);
            var theDay = theDate.getDay(); // í•´ë‹¹ ì›”ì˜ ì²« ë²ˆì§¸ ë‚ ì˜ ìš”ì¼

            // 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ë§ˆì§€ë§‰ ì¼ì„ ë°°ì—´ë¡œ ì €ì¥
            var last = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

            // ìœ¤ë…„ ê³„ì‚°
            if (y % 4 == 0 && y % 100 != 0 || y % 400 == 0) last[1] = 29;

            // í˜„ì¬ ì›”ì˜ ë§ˆì§€ë§‰ ì¼ ì •ë³´
            var lastDate = last[m];

            // í˜„ì¬ ì›”ì˜ ë‹¬ë ¥ì— í•„ìš”í•œ í–‰ì˜ ê°œìˆ˜
            var row = Math.ceil((theDay + lastDate) / 7);

            // ìš”ì¼ í–‰ ìƒì„±
            var calendar = "<table>";
            calendar += "<tr>";
            calendar += "<th>SUN</th>";
            calendar += "<th>MON</th>";
            calendar += "<th>TUE</th>";
            calendar += "<th>WED</th>";
            calendar += "<th>THU</th>";
            calendar += "<th>FRI</th>";
            calendar += "<th>SAT</th>";
            calendar += "</tr>";

            // 1ì¼ë¶€í„° ê¸°ë¡
            var dNum = 1;

            // ì´ì¤‘ forë¬¸ì„ ì´ìš©í•´ ë‹¬ë ¥ í…Œì´ë¸” ìƒì„±
            for (var i = 1; i <= row; i++) {
                calendar += "<tr>"; // í–‰ ìƒì„±

                for (var k = 0; k < 7; k++) { // ì—´ ìƒì„±
                    // ë¹ˆ ë‚ ì§œëŠ” ë¹ˆì¹¸ìœ¼ë¡œ í‘œê¸°
                    if (i === 1 && k < theDay || dNum > lastDate) {
                        calendar += "<td> &nbsp; </td>";
                    } else {
                        // ì˜¤ëŠ˜ ë‚ ì§œ
                        if (dNum === nowD && y === nowY && m === nowM) {
                            calendar += "<td id='today'>" + dNum + "</td>";
                        } else {
                            // ì˜¤ëŠ˜ì´ ì•„ë‹Œ ë‚ ì§œ
                            calendar += "<td>" + dNum + "</td>";
                        }
                        dNum++;
                    }
                }
                calendar += "</tr>";
            }

            // innerHTML ê°’ì„ ë‹¬ë ¥ í…Œì´ë¸”ë¡œ ë³€ê²½
            calendar += "</table>";
            calendar_box.innerHTML = calendar;
        }

        // í˜„ì¬ ì›”ê³¼ ì—°ë„ë¡œ ë‹¬ë ¥ ì¶œë ¥
        displayCurrentMonth(); // ìƒë‹¨ì— ì›” í‘œì‹œ
        printCalendar(); // ë‹¬ë ¥ í‘œì‹œ
    </script>
</body>
</html>