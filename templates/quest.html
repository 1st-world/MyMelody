<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í€˜ìŠ¤íŠ¸ - ë§ˆì´ë©œë¡œë””</title>
    <link rel="icon" href="/static/images/mymelody_favicon.png">
    <link rel="stylesheet" href="/static/sidebar-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ëª¨ë“  ìš”ì†Œì— box-sizingì„ border-boxë¡œ ì„¤ì • */
        *, *::before, *::after {
            box-sizing: border-box;
        }
        body {
            display: flex;
            flex-direction: row;
            width: 100vw;
            height: 100vh;
            margin: 0;
            background-color: #fff4f6;
            font-family: 'Spoqa Han Sans Neo', 'sans-serif';
        }
        .progress-fill {
            width: {{ achievement_rate }}%;
        }
        .content {
            display: flex;
            flex-direction: column;
            width: 65%;
            padding: 20px;
            overflow: hidden;
            height: 100vh;
            text-align: center;
        }
        .quiz-container {
            display: none;
            background-color: #fff;
            width: 100%;
            max-width: 800px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            align-self: center;
            justify-content: cente;
            box-shadow: 0 4px 16px rgba(246, 114, 156, 0.3);
        }
        .quiz-container.active {
            display: block;
        }
        .progress-bar-container {
            background-color: #ffdbdb;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar-fill {
            background-color: #ff7f7f;
            width: 0;
            height: 100%;
            border-radius: 5px;
            transition: width 0.4s ease;
        }
        /* í€´ì¦ˆ 1ì˜ ì˜µì…˜ ìŠ¤íƒ€ì¼ */
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option {
            background-color: white;
            color: #e6a0a0;
            padding: 10px;
            border: none;
            border-radius: 20px;
            box-shadow: 0 4px 16px rgba(246, 114, 156, 0.3);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.4s, box-shadow 0.4s;
        }
        .option:hover {
            background-color: rgba(246, 114, 156, 0.3);
            box-shadow: 0 2px 4px rgba(246, 114, 156, 0.3);
            cursor: pointer;
        }
        .option.correct {
            background-color: #ffaaaa;
            color: white;
        }
        .option.incorrect {
            background-color: #f3d8d7;
            color: white;
        }
        /* í€´ì¦ˆì˜ ë¬¸ì¥ ë°°ì¹˜ ìŠ¤íƒ€ì¼ */
        .sentence {
            color: #333;
            font-size: 22px;
            margin: 30px;
        }
        .drop-zone {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .drop-zone .word {
            display: inline-block;
            background-color: #f0f0f0;
            padding: 20px 30px;
            min-width: 120px;
            border-radius: 10px;
            color: #aaa;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .drag-zone {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        .drag-zone .word {
            background-color: #e0e0ff;
            color: #333;
            font-size: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: visibility 0.3s ease, opacity 0.3s ease;
        }
        .hint {
            display: none;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .image-options img {
            width: 130px;
            margin: 10px;
            border-radius: 1px;
            cursor: pointer;
        }
        .emoji {
            background: none;
            border: none;
            margin: 0;
            padding: 0;
            font-size: 30px;
            cursor: pointer;
        }
        .hidden {
            visibility: hidden;
            opacity: 0;
        }
        .completed {
            background-color: #ff7f7f;
            color: white;
        }
        .btn-final {
            width: 30%;
            height: 40px;
            margin: 20px;
            background-color: #ff7f7f;
            color: white;
            box-shadow: 0 4px 16px rgba(246, 114, 156, 0.3);
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-final:hover {
            opacity: 0.8;
        }
        .btn-final:disabled {
            background-color: #ffccd5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="/main" class="logo-link">
            <img src="/static/images/mymelody_logo.png" alt="ë§ˆì´ë©œë¡œë”” ë¡œê³ ">
        </a>
        <a href="/quest" class="button-link" data-text="í€˜ìŠ¤íŠ¸">ğŸ—ï¸</a>
        <a href="/voice" class="button-link" data-text="AI ëª©ì†Œë¦¬">ğŸ™ï¸</a>
        <a href="/wordle-index" class="button-link" data-text="ì˜ë‹¨ì–´ ê²Œì„">ğŸ®</a>

        <div class="sidebar-bottom">
            <a href="/mypage"> <i class="fas fa-cog"></i> <!-- ì„¤ì • ì•„ì´ì½˜ --> </a>
            <i class="fas fa-sign-out-alt" id="logoutIcon"></i> <!-- ë¡œê·¸ì•„ì›ƒ ì•„ì´ì½˜ -->
        </div>
    </div>
    
    <!-- ë¡œê·¸ì•„ì›ƒ í™•ì¸ ëª¨ë‹¬ -->
    <div id="logoutModal" class="logout-modal">
        <div class="logout-modal-content">
            <p>ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <button id="confirmLogout" class="btn-confirm">ì˜ˆ</button>
            <button id="cancelLogout" class="btn-cancel">ì•„ë‹ˆìš”</button>
        </div>
    </div>

    <div class="content">
        <!-- ì²« ë²ˆì§¸ í€´ì¦ˆ -->
        <div class="quiz-container active" id="quiz-1">
            <div class="progress-bar-container">
                <div class="progress-bar-fill"></div>
            </div>
            <h2>ê·¸ë¦¼ì˜ ì˜ë¯¸ì™€ ê°€ì¥ ê°€ê¹Œìš´ ë‹¨ì–´ëŠ”?</h2>
            <img src="/static/images/quest/{{ quest_data[0]['subquestion'] }}.png" style="max-width: 200px; margin-bottom: 20px;" alt="subquestion">
            <div class="hint">{{ quest_data[0]['hint'] }}</div>
            <div class="options">
                <button class="option" onclick="checkAnswer('{{ quest_data[0]['options_1'] }}', '{{ quest_data[0]['answer'] }}', this, 1)">{{ quest_data[0]['options_1'] }}</button>
                <button class="option" onclick="checkAnswer('{{ quest_data[0]['options_2'] }}', '{{ quest_data[0]['answer'] }}', this, 1)">{{ quest_data[0]['options_2'] }}</button>
                <button class="option" onclick="checkAnswer('{{ quest_data[0]['options_3'] }}', '{{ quest_data[0]['answer'] }}', this, 1)">{{ quest_data[0]['options_3'] }}</button>
            </div>
        </div>
        <!-- ë‘ ë²ˆì§¸ í€´ì¦ˆ -->
        <div class="quiz-container" id="quiz-2">
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 16.7%;"></div>
            </div>
            <h2>ë‹¤ìŒê³¼ ê°™ì€ ì˜ë¯¸ì˜ ë¬¸ì¥ì„ ì™„ì„±í•˜ì„¸ìš”.</h2>
            <p class="sentence">{{ quest_data[1]['subquestion'] }}</p>
            <div class="drop-zone" id="drop-zone-2">
                {% for option in [quest_data[1]['options_1'], quest_data[1]['options_2'], quest_data[1]['options_3'], quest_data[1]['options_4'], quest_data[1]['options_5']] %}
                    {% if option is not none %}
                        <div class="word" onclick="handleWordClick(this, 2)"></div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="drag-zone" id="drag-zone-2">
                <!-- ë‹¨ì–´ê°€ ë¬´ì‘ìœ„ë¡œ ë‚˜ì—´ë¨ -->
            </div>
        </div>
        <!-- ì„¸ ë²ˆì§¸ í€´ì¦ˆ -->
        <div class="quiz-container" id="quiz-3">
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 33.4%;"></div>
            </div>
            <h2>ë‹¤ìŒê³¼ ê°™ì€ ì˜ë¯¸ì˜ ë¬¸ì¥ì„ ì™„ì„±í•˜ì„¸ìš”.</h2>
            <p class="sentence">{{ quest_data[2]['subquestion'] }}</p>
            <div class="drop-zone" id="drop-zone-3">
                {% for option in [quest_data[2]['options_1'], quest_data[2]['options_2'], quest_data[2]['options_3'], quest_data[2]['options_4'], quest_data[2]['options_5']] %}
                    {% if option is not none %}
                        <div class="word" onclick="handleWordClick(this, 3)"></div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="drag-zone" id="drag-zone-3">
                <!-- ë‹¨ì–´ê°€ ë¬´ì‘ìœ„ë¡œ ë‚˜ì—´ë¨ -->
            </div>
        </div>
        <!-- ë„¤ ë²ˆì§¸ í€´ì¦ˆ -->
        <div class="quiz-container" id="quiz-4">
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 50.1%;"></div>
            </div>
            <h2>ë‹¨ì–´ë¥¼ ë“£ê³  ì–´ìš¸ë¦¬ëŠ” ê·¸ë¦¼ì„ ê³ ë¥´ì„¸ìš”.</h2>
            <button class="emoji" onclick="playAudio('{{ quest_data[3]['audio_file'] }}')">ğŸ“¢</button>
            <p>ë“¤ìœ¼ë ¤ë©´ í™•ì„±ê¸°ë¥¼ ëˆ„ë¥´ì„¸ìš”!</p>
            <div class="hint">{{ quest_data[3]['hint'] }}</div>
            <div class="image-options">
                <img src="/static/images/quest/{{ quest_data[3]['options_1'] }}.png" alt="{{ quest_data[3]['options_1'] }}" onclick="checkAnswer('{{ quest_data[3]['options_1'] }}', '{{ quest_data[3]['answer'] }}', this, 4)">
                <img src="/static/images/quest/{{ quest_data[3]['options_2'] }}.png" alt="{{ quest_data[3]['options_2'] }}" onclick="checkAnswer('{{ quest_data[3]['options_2'] }}', '{{ quest_data[3]['answer'] }}', this, 4)">
                <img src="/static/images/quest/{{ quest_data[3]['options_3'] }}.png" alt="{{ quest_data[3]['options_3'] }}" onclick="checkAnswer('{{ quest_data[3]['options_3'] }}', '{{ quest_data[3]['answer'] }}', this, 4)">
            </div>
        </div>
        <!-- ë‹¤ì„¯ ë²ˆì§¸ í€´ì¦ˆ -->
        <div class="quiz-container" id="quiz-5">
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 66.8%;"></div>
            </div>
            <h2>ë¬¸ì¥ì„ ë“£ê³  ìˆœì„œì— ë§ê²Œ ë‚˜ì—´í•˜ì„¸ìš”.</h2>
            <button class="emoji" onclick="playAudio('{{ quest_data[4]['audio_file'] }}')">ğŸ“¢</button>
            <p>ë“¤ìœ¼ë ¤ë©´ í™•ì„±ê¸°ë¥¼ ëˆ„ë¥´ì„¸ìš”!</p>
            <div class="drop-zone" id="drop-zone-5">
                {% for option in [quest_data[4]['options_1'], quest_data[4]['options_2'], quest_data[4]['options_3'], quest_data[4]['options_4'], quest_data[4]['options_5']] %}
                    {% if option is not none %}
                        <div class="word" onclick="handleWordClick(this, 5)"></div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="drag-zone" id="drag-zone-5">
                <!-- ë‹¨ì–´ê°€ ë¬´ì‘ìœ„ë¡œ ë‚˜ì—´ë¨ -->
            </div>
        </div>
        <!-- ì—¬ì„¯ ë²ˆì§¸ í€´ì¦ˆ -->
        <div class="quiz-container" id="quiz-6">
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 83.5%;"></div>
            </div>
            <h2>ë‹¤ìŒ ë¬¸ì¥ì„ ì½ì–´ë³´ì„¸ìš”.</h2>
            <div class="sentence">
                <span>{{ quest_data[5]['subquestion'] }}</span>
            </div>
            <button class="emoji" onclick="playAudio('{{ quest_data[5]['audio_file'] }}')">ğŸ“¢</button>
            <p>ë“¤ìœ¼ë ¤ë©´ í™•ì„±ê¸°ë¥¼ ëˆ„ë¥´ì„¸ìš”!</p><br>
            <button class="emoji" onclick="startRecording()">ğŸ™ï¸</button>
            <p>ë…¹ìŒí•˜ë ¤ë©´ ë§ˆì´í¬ë¥¼ ëˆ„ë¥´ì„¸ìš”!</p>
            <div id="next-steps" style="display: none; margin-top: 20px;">
                <button class="btn-final" onclick="location.href='/quest?stage={{ quest_data[5]['stage_id'] + 1 }}'" {% if achievement_rate == 100 and quest_data[5]['stage_id'] == 21 %}disabled{% endif %}>ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
                <button class="btn-final" onclick="location.href='/main'">ì—¬ê¸°ê¹Œì§€ í• ë˜ìš”</button>
            </div>
        </div>
    </div>

    <div class="right-panel">
        <div class="profile">
            <img id="profile-pic" src="/static/images/profile/{{ profile_img }}" alt="í”„ë¡œí•„ ì‚¬ì§„">
            <div>
                <p id="user-info"> {{ nickname }} ë‹˜! ì˜¤ëŠ˜ë„ ì—´ê³µğŸ”¥</p>
            </div>
        </div>
        <div class="quote">
            <p style="font-weight: bold;">ğŸ“£ ëª…ì–¸ ì˜ì–´ë¡œ ë³´ê¸°</p>
            <div class="quote-text">
                <p id="quote-ko">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>
                <p id="quote-en">-</p>
            </div>
        </div>
        <div class="progress">
            <p style="font-weight: bold;">ğŸ¯ ëª©í‘œ ë‹¬ì„±ë¥ </p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
        <div class="calendar">
            <p style="font-weight: bold;">ğŸ—“ï¸ ì¶œì„ ë‹¬ë ¥</p>
            <input type="text" id="current-date" readonly>
            <div class="calendar-box">
                <div id="current-month"></div>
                <!-- ë‹¬ë ¥ì´ í‘œì‹œë  ì˜ì—­ -->
                <div id="calendar"></div>
            </div>
        </div>
    </div>

    <script>
        let currentQuiz = 1;

        function showQuiz(quizNumber) {
            document.querySelectorAll('.quiz-container').forEach((quiz, index) => {
                quiz.classList.remove('active');
                if (index + 1 === quizNumber) {
                    quiz.classList.add('active');
                }
            });
            currentQuiz = quizNumber;
        }

        function checkAnswer(userAnswer, answer, buttonElement, quizNumber) {
            const hintElement = buttonElement.closest('.quiz-container').querySelector('.hint'); // í•´ë‹¹ ë¬¸ì œì˜ íŒíŠ¸ ì°¾ê¸°
            if (userAnswer === answer) {
                moveProgressBar(quizNumber);
                setTimeout(() => {
                    if (quizNumber < 6) {
                        showQuiz(quizNumber + 1);
                    } else {
                        alert('ëª¨ë“  í€´ì¦ˆë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!');
                    }
                }, 500);
            } else {
                alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”!');
                hintElement.style.display = 'block'; // íŒíŠ¸ í‘œì‹œ
            }
        }

        let progress = 0;
        function moveProgressBar(quizNumber) {
            progress += 16.7;
            const progressBar = document.querySelector(`#quiz-${quizNumber} .progress-bar-fill`);
            progressBar.style.width = progress + '%';
        }

        function playAudio(audioFile) {
            const audio = new Audio(audioFile);
            audio.play();
        }

        let valid_options1 = [];
        // ì„œë²„ ì¸¡ ì½”ë“œ
        {% for i in range(1, 6) %}
            {% set option = quest_data[1]['options_' ~ i] %}
            {% if option is not none and option != '' %}
                valid_options1.push("{{ option | e }}");
            {% endif %}
        {% endfor %}

        let valid_options2 = [];
        // ì„œë²„ ì¸¡ ì½”ë“œ
        {% for i in range(1, 6) %}
            {% set option = quest_data[2]['options_' ~ i] %}
            {% if option is not none and option != '' %}
                valid_options2.push("{{ option | e }}");
            {% endif %}
        {% endfor %}

        let valid_options3 = [];
        // ì„œë²„ ì¸¡ ì½”ë“œ
        {% for i in range(1, 6) %}
            {% set option = quest_data[4]['options_' ~ i] %}
            {% if option is not none and option != '' %}
                valid_options3.push("{{ option | e }}");
            {% endif %}
        {% endfor %}

        let sentences = [
            {
                words1: valid_options1,
                words2: valid_options2,
                words3: valid_options3
            }
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function renderDragZone(words1, words2, words3) {
            const dragZone1 = document.getElementById('drag-zone-2');
            const dragZone2 = document.getElementById('drag-zone-3');
            const dragZone3 = document.getElementById('drag-zone-5');

            const shuffledWords1 = shuffleArray([...words1]);
            const shuffledWords2 = shuffleArray([...words2]);
            const shuffledWords3 = shuffleArray([...words3]);

            dragZone1.innerHTML = shuffledWords1.map(word => `
                <div class="word" onclick="handleWordClick(this, 2)">${word}</div>
            `).join('');
            dragZone2.innerHTML = shuffledWords2.map(word => `
                <div class="word" onclick="handleWordClick(this, 3)">${word}</div>
            `).join('');
            dragZone3.innerHTML = shuffledWords3.map(word => `
                <div class="word" onclick="handleWordClick(this, 5)">${word}</div>
            `).join('');
        }

        let dropIndex = 0;
        let dropZones;
        let usedWords = [];

        function handleWordClick(element, quizNumber) {
            const wordText = element.textContent;

            if (element.parentElement.classList.contains('drag-zone')) {
                // Drag zone â†’ drop zoneìœ¼ë¡œ ì´ë™
                if (dropIndex < dropZones.length) {
                    dropZones[dropIndex].textContent = wordText;
                    dropZones[dropIndex].classList.add('completed');
                    usedWords.push({element, index: dropIndex});
                    element.classList.add('hidden');
                    dropIndex++;
                }
                // í˜„ì¬ drag-zoneì˜ ë‹¨ì–´ë“¤ì´ ëª¨ë‘ hidden ìƒíƒœì¸ì§€ ì²´í¬
                const allHidden = Array.from(document.getElementById('drag-zone-'+quizNumber).children).every(word => word.classList.contains('hidden'));
                if (allHidden) {
                    setTimeout(checkCompletion(quizNumber), 500);
                }
            } else if (element.parentElement.classList.contains('drop-zone')) {
                // Drop zone â†’ drag zoneìœ¼ë¡œ ì´ë™
                const usedWord = usedWords.find(wordObj => wordObj.index === Array.from(dropZones).indexOf(element));
                if (usedWord) {
                    usedWord.element.classList.remove('hidden');
                    element.textContent = '';
                    element.classList.remove('completed');
                    dropIndex--;
                    usedWords = usedWords.filter(wordObj => wordObj.index !== Array.from(dropZones).indexOf(element));
                }
            }
        }

        const questData = {{ quest_data|tojson }};
        function checkCompletion(quizNumber) {
            const dropZones = document.querySelectorAll(`#drop-zone-${quizNumber} .word`);
            const correctAnswers = questData[quizNumber-1]['answer'].trim();
            let userAnswers = '';

            // ì‚¬ìš©ì ì…ë ¥ì„ ë¬¸ìì—´ë¡œ í•©ì¹˜ê¸°
            userAnswers = Array.from(dropZones).map(zone => zone.textContent).join('');
            if (userAnswers === correctAnswers) {
                moveProgressBar(quizNumber);
                setTimeout(() => {
                    showQuiz(quizNumber + 1);
                }, 500);
            } else {
                alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”!');
            }
        }

        function onRecordingComplete() {
            // ì„œë²„ì— ë°ì´í„° ì „ì†¡
            fetch('/quest-complete', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    stage: '{{ quest_data[5]['stage_id'] }}'
                })
            })
            // ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    moveProgressBar(6);
                    document.getElementById('next-steps').style.display = 'block';
                } else if (data.message) {
                    // ì‹¤íŒ¨ ì‹œ ë©”ì‹œì§€ ì¶œë ¥
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('ì˜¤ë¥˜ ë°œìƒ: ', error); // ì˜¤ë¥˜ ë°œìƒ ì‹œ consoleì— ì¶œë ¥
                alert('ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.');
            });
        }

        let isRecording = false;
        let mediaRecorder;
        let audioChunks = [];

        async function startRecording() {
            if (isRecording) {
                alert("ì´ë¯¸ ë…¹ìŒ ì¤‘ì…ë‹ˆë‹¤!");
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks);
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    audio.play();

                    alert("ë…¹ìŒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ìƒì„ ì‹œì‘í•©ë‹ˆë‹¤.");
                };

                mediaRecorder.start();
                isRecording = true;

                alert("ë…¹ìŒì„ ì‹œì‘í•©ë‹ˆë‹¤. ë¬¸ì¥ì„ ì½ì–´ì£¼ì„¸ìš”.");

                setTimeout(() => {
                    mediaRecorder.stop();
                    isRecording = false;
                }, 5000);
            } catch (error) {
                alert("ë§ˆì´í¬ê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.");
            }

            onRecordingComplete();
        }

        document.addEventListener('DOMContentLoaded', () => {
            showQuiz(1);
            renderDragZone(sentences[0].words1, sentences[0].words2, sentences[0].words3);
            dropZones = document.querySelectorAll('.drop-zone .word');
        });

        document.addEventListener('DOMContentLoaded', function() {
            const logoutModal = document.getElementById('logoutModal');

            // ë¡œê·¸ì•„ì›ƒ ì•„ì´ì½˜ í´ë¦­ ì‹œ ëª¨ë‹¬
            document.getElementById('logoutIcon').addEventListener('click', function() {
                logoutModal.style.display = 'flex';
                logoutModal.style.opacity = 1;
            });
            document.getElementById('confirmLogout').addEventListener('click', function() {
                window.location.href = 'user-logout';
            });
            document.getElementById('cancelLogout').addEventListener('click', function() {
                logoutModal.style.opacity = 0;
                setTimeout(() => {
                    logoutModal.style.display = 'none';
                }, 100);
            });
        });
    </script>

    <script>
        // ëª…ì–¸ ë°ì´í„°
        const quotes = [
            { ko: "ê³ í†µ ì—†ì´ëŠ” ì–»ëŠ” ê²ƒë„ ì—†ë‹¤.", en: "No pain, no gain." },
            { ko: "ë°°ì›€ì€ ê²°ì½” ëë‚˜ì§€ ì•ŠëŠ”ë‹¤.", en: "Learning never ends." },
            { ko: "ì˜¤ëŠ˜ í•  ìˆ˜ ìˆëŠ” ì¼ì„ ë‚´ì¼ë¡œ ë¯¸ë£¨ì§€ ë§ˆë¼.", en: "Do not put off until tomorrow what you can do today." },
            { ko: "ì§€ì‹ì€ í˜ì´ë‹¤.", en: "Knowledge is power." },
            { ko: "ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆë‹¤.", en: "Failure is the mother of success." },
            { ko: "ë…¸ë ¥ì€ ê²°ì½” ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤.", en: "Effort never betrays." },
            { ko: "ìì‹ ì„ ë¯¿ì–´ë¼.", en: "Believe in yourself." },
            { ko: "í•œ ê±¸ìŒì”© ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ë¼.", en: "Take one step forward." },
            { ko: "ê¿ˆì„ í¬ê²Œ ê°€ì ¸ë¼.", en: "Dream big." },
            { ko: "ë§¤ì¼ ì¡°ê¸ˆì”© ë‚˜ì•„ì ¸ë¼.", en: "Get a little better every day." },
            { ko: "í•  ìˆ˜ ìˆë‹¤ê³  ë¯¿ì–´ë¼.", en: "Believe you can." },
            { ko: "ìì‹ ì˜ ê¸¸ì„ ì°¾ì•„ë¼.", en: "Find your own path." },
            { ko: "ì§€ê¸ˆ í–‰ë™í•˜ë¼.", en: "Act now." },
            { ko: "ê¸°íšŒëŠ” ì¤€ë¹„ëœ ìì—ê²Œ ì˜¨ë‹¤.", en: "Opportunity comes to those who are prepared." },
            { ko: "ì ˆëŒ€ í¬ê¸°í•˜ì§€ ë§ˆë¼.", en: "Never give up." },
            { ko: "ìì‹ ì˜ ì ì¬ë ¥ì„ ë¯¿ì–´ë¼.", en: "Believe in your potential." },
            { ko: "ìì‹ ì„ ë°œì „ì‹œì¼œë¼.", en: "Develop yourself." },
            { ko: "ì„±ê³µì€ ë…¸ë ¥ì˜ ê²°ê³¼ë‹¤.", en: "Success is the result of effort." },
            { ko: "ë¯¸ë˜ëŠ” ì§€ê¸ˆ ë§Œë“ ë‹¤.", en: "The future is made now." },
            { ko: "ê¾¸ì¤€í•¨ì´ ì—´ì‡ ë‹¤.", en: "Consistency is the key." }
        ];

        // ëœë¤ ëª…ì–¸ ì„ íƒ
        function displayRandomQuote() {
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const randomQuote = quotes[randomIndex];
            document.getElementById("quote-ko").innerText = randomQuote.ko;
            document.getElementById("quote-en").innerText = randomQuote.en;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª…ì–¸ í‘œì‹œ
        window.onload = displayRandomQuote;
        function displayCurrentMonth() {
            var currentDate = new Date(); // í˜„ì¬ ë‚ ì§œ ê°ì²´ ìƒì„±
            var monthNames = [
                "1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”",
                "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"
            ];
            var currentMonth = currentDate.getMonth(); // í˜„ì¬ ì›” ê°€ì ¸ì˜¤ê¸° (0ë¶€í„° ì‹œì‘)

            document.getElementById("current-month").innerHTML = monthNames[currentMonth];        
        }

        // ë‹¬ë ¥ì„ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function printCalendar(y, m) {
            var calendar_box = document.getElementById("calendar");

            // í˜„ì¬ ë‚ ì§œì™€ í˜„ì¬ ë‹¬ì— 1ì¼ì˜ ë‚ ì§œ ê°ì²´ ìƒì„±
            var date = new Date();
            var nowY = date.getFullYear(); // í˜„ì¬ ì—°ë„
            var nowM = date.getMonth(); // í˜„ì¬ ì›”
            var nowD = date.getDate(); // í˜„ì¬ ì¼

            // ì—°ë„, ì›”ì„ ì…ë ¥ë°›ì§€ ì•Šì€ ê²½ìš° í˜„ì¬ ë‚ ì§œì˜ ì—°ë„, ì›” ì •ë³´ë¥¼ ì‚¬ìš©í•¨
            y = (y != undefined) ? y : nowY;
            m = (m != undefined) ? m - 1 : nowM;

            // í˜„ì¬ ì›”ì˜ 1ì¼ ì •ë³´
            var theDate = new Date(y, m, 1);
            var theDay = theDate.getDay(); // í•´ë‹¹ ì›”ì˜ ì²« ë²ˆì§¸ ë‚ ì˜ ìš”ì¼

            // 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ë§ˆì§€ë§‰ ì¼ì„ ë°°ì—´ë¡œ ì €ì¥
            var last = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

            // ìœ¤ë…„ ê³„ì‚°
            if (y % 4 == 0 && y % 100 != 0 || y % 400 == 0) last[1] = 29;

            // í˜„ì¬ ì›”ì˜ ë§ˆì§€ë§‰ ì¼ ì •ë³´
            var lastDate = last[m];

            // í˜„ì¬ ì›”ì˜ ë‹¬ë ¥ì— í•„ìš”í•œ í–‰ì˜ ê°œìˆ˜
            var row = Math.ceil((theDay + lastDate) / 7);

            // ìš”ì¼ í–‰ ìƒì„±
            var calendar = "<table>";
            calendar += "<tr>";
            calendar += "<th>SUN</th>";
            calendar += "<th>MON</th>";
            calendar += "<th>TUE</th>";
            calendar += "<th>WED</th>";
            calendar += "<th>THU</th>";
            calendar += "<th>FRI</th>";
            calendar += "<th>SAT</th>";
            calendar += "</tr>";

            // 1ì¼ë¶€í„° ê¸°ë¡
            var dNum = 1;

            // ì´ì¤‘ forë¬¸ì„ ì´ìš©í•´ ë‹¬ë ¥ í…Œì´ë¸” ìƒì„±
            for (var i = 1; i <= row; i++) {
                calendar += "<tr>"; // í–‰ ìƒì„±

                for (var k = 0; k < 7; k++) { // ì—´ ìƒì„±
                    // ë¹ˆ ë‚ ì§œëŠ” ë¹ˆì¹¸ìœ¼ë¡œ í‘œê¸°
                    if (i === 1 && k < theDay || dNum > lastDate) {
                        calendar += "<td> &nbsp; </td>";
                    } else {
                        // ì˜¤ëŠ˜ ë‚ ì§œ
                        if (dNum === nowD && y === nowY && m === nowM) {
                            calendar += "<td id='today'>" + dNum + "</td>";
                        } else {
                            // ì˜¤ëŠ˜ì´ ì•„ë‹Œ ë‚ ì§œ
                            calendar += "<td>" + dNum + "</td>";
                        }
                        dNum++;
                    }
                }
                calendar += "</tr>";
            }

            // innerHTML ê°’ì„ ë‹¬ë ¥ í…Œì´ë¸”ë¡œ ë³€ê²½
            calendar += "</table>";
            calendar_box.innerHTML = calendar;
        }

        // í˜„ì¬ ì›”ê³¼ ì—°ë„ë¡œ ë‹¬ë ¥ ì¶œë ¥
        displayCurrentMonth(); // ìƒë‹¨ì— ì›” í‘œì‹œ
        printCalendar(); // ë‹¬ë ¥ í‘œì‹œ
    </script>
</body>
</html>
